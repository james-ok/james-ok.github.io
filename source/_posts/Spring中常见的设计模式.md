---
title: Spring中常见的设计模式
date: 2019-09-20 22:11:31
categories: Spring
tags:
- 设计模式
- Spring
top: true
---

Spring作为Java必选框架，必然有它吸引人之处，不光是实现逻辑的便利性上，还体现在代码质量。可以说，Spring是一个很讲究的框架，似乎不能容忍任何的设计不合理或者追求极致。
今天我们就来探讨一下Spring中常用的设计模式

## 工厂模式

概述：只关心产品生产，不做三无产品，spring中常见于BeanFactory，工厂模式也可分为以下几种：
   1. 简单工厂：用户需要告诉工厂需要什么产品，由工厂生产
   2. 工厂方法：用户根据自己的需求选择相应的工厂
   3. 抽象工厂：工厂给出一系列产品族供用户选择
   
## 单例模式

概述：一个类在程序的生命周期中只会产生一个实例  
前提：私有化构造方法
   1. 饿汉式：不管是否有调用，都会创建一个实例，该方式是线程安全的
   2. 懒汉式：当用到实例时，会判断是否已存在该类的实例，如果存在，则直接返回，如果不存在，则创建返回，该方式是线程非安全的，使用时需要考虑线程安全问题，所以效率上会有所差异
   3. 注册登记式：在需要单例的类中定义一个map，每次获取实例时在map中get，如果存在，则直接返回，如果不存在，像map中put一个实例，最后返回，spring中单例bean通过该方式实现
   4. 枚举式：隶属于注册登记式
   5. 序列化和反序列化：通过java的对象序列化实现，类需要实现Seriablizable接口，重写readResovle方法
   
## 原型模式

概述：将原有对象的属性复制到另一个新的对象中
   1. 克隆：实现Cloneable接口，重写clone方法，该方式属于浅克隆（属性中如果包含其他对象，则拷贝其属性对象的引用）
   2. 序列化和反序列化：需要实现Seriablizable接口
   
## 代理模式

概述：为目标类创建一个代理对象，使其业务得到增强
   1. 静态代理：一切都是已知的，代理对象须包含目标对象的引用
   2. JDK动态代理：目标对象必须实现接口，生产的代理对象集成自目标对象的所有接口
   3. CGLIB动态代理：通过继承的方式实现代理，CGLIB生产的代理对象继承自目标对象，无需实现任何接口
   4. 自定义实现动态代理
   
动态代理的实现原理（JDK）：
      1. 获取目标对象实现的所有接口
      2. 动态生成代理java类（实现目标对象的所有接口，增强目标代理方法）
      3. 将.java文件编译成.class文件
      4. 将字节码文件加载到JVM中
      5. 返回代理对象
      
## 策略模式

概述：用户根据自己的业务逻辑在已存在的一系列算法中选择，切新增算法不会影响原有逻辑，如订单支付，用户可以选择使用支付宝或者微信支付，可以替换掉程序中的switch和if…else if…else…语法

## 模板模式

概述：流程固定，流程中的某一个环节用户可以自定义
   1. JDBC的固定流程如下
      1. 加载驱动
      2. 建立连接
      3. 创建预编译sql语句
      4. 执行预编译sql语句
      5. 返回结果集
      6. 回收资源
      
以上流程是固定的，无论用户使用哪一种数据库，都会根据上面的步骤执行，但用户可以自定义其中某一个步骤，例如用户可以选择加载oracle驱动或者mysql驱动，结果返回由用户指定结果集接收

## 委派模式

概述：委派模式有些类似于静态代理模式和策略模式，属于静态代理和策略模式中一种特殊的模式
   1. 例如老板需要做一个登录的功能，将需求告知给项目经理，项目经理对手上的员工擅长能力都非常了解，项目经理根据员工擅长的领域，选择决定让某一个人来完成这个功能。
      1. 这其中项目经理就如同老板的中介，这点有点类似于代理模式中的代理对象，普通员工就是被代理对象，而代理模式中代理对象需要持有被代理对象的引用，而这里的项目经理也需要持有普通员工对象的引用。
      2. 项目经理根据员工的擅长领域来做决策，这点类似于策略模式
      
## 适配器模式

概述：在不改变原有逻辑的情况下扩展（向下兼容），简而言之，将一个类的接口转换成客户端希望的另一个接口

## 装饰器模式

概述：包装者和被包装者都实现同一个接口，且包装者持有被包装者的引用，包装者是被包装者的一种增强，但本质也属于被包装者类型。例如InputStream和DataInputStream的关系

## 观察者模式

概述：被观察者在做完某件事情过后通知观察者，主要是为了解耦